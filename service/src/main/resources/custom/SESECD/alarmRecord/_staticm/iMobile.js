var iMobilejs=function(){"use strict";const e=({type:e,url:n,params:o},t)=>{const i=new XMLHttpRequest;var a=localStorage.getItem("ticket");return a="Bearer "+a,new Promise(((e,c)=>{i.open("GET",n,!1),i.setRequestHeader("Content-Type","application/json"),i.setRequestHeader("Authorization",a),i.onreadystatechange=function(){if(4===i.readyState){if(0!==i.status&&200!==i.status)throw c("接口认证失败"),new Error(`Could not load ${n}`);{const{response:n}=i;t&&t(n),n.indexOf("<!DOCTYPE")>-1?c("接口认证失败"):e(n?JSON.parse(n):n)}}},i.send(o||null)}))},n=e=>{const n=new RegExp(`(^| )${e}=([^;]*)(;|$)`),o=document.cookie.match(n);return o?unescape(o[2]):null};const o=(e,n)=>{if(n)return new Error(`当前环境不支持方法：${e} 执行.`)},t=()=>n("mobileTheme")||"IN"===n("InMobile"),i=e=>new Promise((n=>{let o=e||"default";t()&&window.wvbridge.getTheme?window.wvbridge.getTheme((e=>{n(e=e||"default")})):n(o)})),a=e=>{const n=e||"zh-cn";return new Promise((e=>{t()&&window.wvbridge.getLanguage?window.wvbridge.getLanguage((n=>{e(n=n||"zh-cn")})):e(n)}))},c=()=>new Promise((e=>{t()&&window.wvbridge.getTicket?window.wvbridge.getTicket((n=>{e(n=n||"")})):e("")}));var r={initBridge:function(e){function n(e){if(window.WebViewJavascriptBridge?e(window.WebViewJavascriptBridge):document.addEventListener("WebViewJavascriptBridgeReady",(()=>{e(window.WebViewJavascriptBridge)}),!1),window.WVJBCallbacks)return window.WVJBCallbacks.push(e);window.WVJBCallbacks=[e];let n=document.createElement("iframe");n.style.display="none",n.src="wvjbscheme://__BRIDGE_LOADED__",document.documentElement.appendChild(n),setTimeout((()=>{document.documentElement.removeChild(n)}),0)}e||(e=()=>{}),window.wvbridge={setupWebViewJavascriptBridge:n,closeController:function(){n((e=>{e&&e.callHandler("closeController")}))},webGoBack:function(){n((e=>{e&&e.callHandler("webGoBack")}))},createNewWeb:function(e){n((n=>{n&&n.callHandler("createNewWeb",e)}))},setNavigationTitle:function(e){n((n=>{n&&n.callHandler("setNavigationTitle",e)}))},loginAgain:function(){n((e=>{e&&e.callHandler("loginAgain",{param:""})}))},getUserMessage:function(e){n((n=>{n&&n.callHandler("getUserMessage",{param:""},e)}))},getLocation:function(e){n((n=>{n&&n.callHandler("getLocation",{param:""},e)}))},getTheme:function(e){n((n=>{n&&n.callHandler("getTheme",{param:""},e)}))},getLanguage:function(e){n((n=>{n&&n.callHandler("getLanguage",{param:""},e)}))},getTicket:function(e){n((n=>{n&&n.callHandler("getTicket",{param:""},e)}))},setScreenOrientation:function(e){n((n=>{n&&n.callHandler("setScreenOrientation",e)}))},listRefresh:function(){n((e=>{e&&e.callHandler("listRefresh")}))},downloadFile:function(e){n((n=>{n&&n.callHandler("downloadFile",e)}))},openQRCode:function(e){n((n=>{n&&n.callHandler("openQRCode",{param:""},e)}))},openInfrared:function(e){n((n=>{n&&n.callHandler("openInfrared",{param:""},e)}))},openNFC:function(e){n((n=>{n&&n.callHandler("openNFC",{param:""},e)}))},faceRecognition:function(e){n((n=>{n&&n.callHandler("faceRecognition",{param:""},e)}))},onShowFileChooser:function(e,o){n((n=>{n&&n.callHandler("onShowFileChooser",e,o)}))}},e&&e()},clearLocalStoreage:()=>{window.localStorage.removeItem("mobileTheme")},isInMobileWebView:t,closeController:()=>{t()&&window.wvbridge.closeController?window.wvbridge.closeController():o("closeController")},webGoBack:()=>{t()&&window.wvbridge.webGoBack?window.wvbridge.webGoBack():o("webGoBack")},createNewWeb:e=>{t()&&window.wvbridge.createNewWeb?window.wvbridge.createNewWeb(e):o("createNewWeb")},setNavigationTitle:e=>{t()&&window.wvbridge.setNavigationTitle?window.wvbridge.setNavigationTitle(e):o("setNavigationTitle")},loginAgain:()=>{t()&&window.wvbridge.loginAgain?window.wvbridge.loginAgain():o("loginAgain")},getLocation:()=>new Promise(((e,n)=>{t()&&window.wvbridge.getLocation?window.wvbridge.getLocation((n=>{"object"==typeof n&&"[object object]"==Object.prototype.toString.call(n).toLowerCase()?e(n):e(JSON.parse(n))})):n(o("getLocation",!0))})),getUserMessage:()=>new Promise(((e,n)=>{t()&&window.wvbridge.getUserMessage?window.wvbridge.getUserMessage((n=>{"object"==typeof n&&"[object object]"==Object.prototype.toString.call(n).toLowerCase()?e(n):e(JSON.parse(n))})):n(o("getUserMessage",!0))})),getTheme:()=>{const e=n("mobileTheme");return e?Promise.resolve(e):i()},getLanguage:()=>{const e=n("mobileLanguage");return e?Promise.resolve(e):a()},getLanguageAtCookie:()=>{const e=n("mobileLanguage");return e||""},setTheme:i,setLanguage:a,getTicket:()=>{const e=n("suposTicket");return e?Promise.resolve(e):c()},getTicketAtCookie:()=>{const e=n("suposTicket");return e||""},getTicketAtWebView:c,setScreenOrientation:e=>{t()&&window.wvbridge.setScreenOrientation?window.wvbridge.setScreenOrientation(e):o("setScreenOrientation")},listRefresh:()=>{t()&&window.wvbridge.listRefresh?window.wvbridge.listRefresh():o("listRefresh")},downloadFile:e=>{t()&&window.wvbridge.downloadFile?window.wvbridge.downloadFile(e):o("downloadFile")},openQRCode:()=>new Promise(((e,n)=>{t()&&window.wvbridge.openQRCode?window.wvbridge.openQRCode((n=>{"object"==typeof n&&"[object object]"==Object.prototype.toString.call(n).toLowerCase()?e(n):e(JSON.parse(n))})):n(o("openQRCode",!0))})),openInfrared:()=>new Promise(((e,n)=>{t()&&window.wvbridge.openInfrared?window.wvbridge.openInfrared((n=>{"object"==typeof n&&"[object object]"==Object.prototype.toString.call(n).toLowerCase()?e(n):e(JSON.parse(n))})):n(o("openInfrared",!0))})),openNFC:()=>new Promise(((e,n)=>{t()&&window.wvbridge.openNFC?window.wvbridge.openNFC((n=>{"object"==typeof n&&"[object object]"==Object.prototype.toString.call(n).toLowerCase()?e(n):e(JSON.parse(n))})):n(o("openNFC",!0))})),faceRecognition:()=>new Promise(((e,n)=>{t()&&window.wvbridge.faceRecognition?window.wvbridge.faceRecognition((n=>{"object"==typeof n&&"[object object]"==Object.prototype.toString.call(n).toLowerCase()?e(n):e(JSON.parse(n))})):n(o("faceRecognition",!0))})),onShowFileChooser:function(e,n){t()&&window.wvbridge.onShowFileChooser?window.wvbridge.onShowFileChooser(e,n):o("getLocation")}};let s=!1,l=!1;const d="钉钉微应用不支持此功能，请在iMobile中体验完整功能",w="https://g.alicdn.com/dingding/dingtalk-jsapi/3.0.12/dingtalk.open.js";function g(){alert(d)}function u(n){!function(n){localStorage.getItem("ticket");const o=window.location.href;e({url:`/msService/public/base/jsapi/oAuth?oAuthType=dingtalk&openUrl=${o}`}).then((e=>{const o=e.data;n({agentId:o.agentId,corpId:o.corpId,timeStamp:o.timeStamp,nonceStr:o.nonceStr,signature:o.signature})})).catch((e=>{l=!0}))}((e=>{const o=window.dd;o.config({...e,jsApiList:["biz.util.chooseImage","device.geolocation.get"]}),o.ready((function(){n&&n(o),s=!0})),o.error((function(e){l=!0}))}))}function f(e,n=!0){const o=window.dd;if(o)l&&n?alert("配置失败请刷新页面"):!s&&n?u(e):e&&e(o);else{const n=document.createElement("script");n.src=w,document.querySelector("head")?.appendChild(n),n.readyState?n.onreadystatechange=()=>{u(e)}:n.onload=()=>{u(e)},window.supmobilejs||(window.supmobilejs={setupWebViewJavascriptBridge:f,scanQRCode:h,openVideo:()=>{},downloadFile:()=>{},pidTakePhoto:()=>{},faceRecognition:()=>{}}),window.mobilejs||(window.mobilejs={setupWebViewJavascriptBridge:f,close:p,webGoBack:b,pushVC:m,scanQRCode:h})}}function p(){f((e=>{e.biz.navigation.close({onSuccess:function(e){},onFail:function(e){}})}),!1)}function b(){f((e=>{e.biz.navigation.goBack({onSuccess:function(e){},onFail:function(e){}})}),!1)}function m(e){f((n=>{n.biz.util.openLink({url:window.location.origin+e,onSuccess:function(e){},onFail:function(e){}})}),!1)}function h(e){return new Promise((n=>{f((o=>{o.biz.util.scan({type:"all",onSuccess:function(o){e&&e(o),n(o)},onFail:function(e){}})}))}))}const v=()=>{const e=n("suposTicket");return e||""};var C={initBridge:f,clearLocalStoreage:()=>{},closeController:p,webGoBack:b,createNewWeb:m,setNavigationTitle:function(e){f((n=>{n.biz.navigation.setTitle({title:e,onSuccess:function(e){},onFail:function(e){}})}))},loginAgain:()=>{},getLocation:function(e){return new Promise((n=>{f((o=>{o.device.geolocation.get({targetAccuracy:200,coordinate:0,withReGeocode:!1,useCache:!0,onSuccess:function(o){const t={latitude:o.latitude,longitude:o.longitude};e&&e(t),n(t)},onFail:function(e){}})}))}))},getUserMessage:()=>{},getTheme:function(){return Promise.resolve("default")},getLanguage:function(e){var n=window.navigator.language;n.includes("zh-")?n="zh-cn":n.includes("en-")&&(n="en-us"),e(n)},isInMobileWebView:()=>"dingtalk",getLanguageAtCookie:function(){const e=n("mobileLanguage");return e||""},setTheme:g,setLanguage:g,getTicket:v,getTicketAtCookie:v,getTicketAtWebView:g,setScreenOrientation:function(e){f((n=>{"03"==e?n.device.screen.resetView({onSuccess:function(e){},onFail:function(e){}}):"04"==e&&n.device.screen.rotateView({showStatusBar:!0,clockwise:!0,onSuccess:function(e){},onFail:function(e){}})}))},listRefresh:function(){const{ReactAPI:e}=window;e&&"function"==typeof e.refreshList&&e.refreshList()},downloadFile:function(e){f((n=>{n.biz.util.downloadFile({url:e.downloadUrl,name:e.fileName,success:e=>{},fail:()=>{},complete:()=>{}})}))},openQRCode:h,openInfrared:g,openNFC:function(e){return new Promise(((n,o)=>{f((t=>{t.device.nfc.nfcRead({onSuccess:function(o){e&&e(o),n(o)},onFail:function(e){o(e)}})}))}))},onShowFileChooser:function(e,n){f((o=>{let t=1,i=["camera","album"];"camera"==e?(t=1,i=["camera"]):"albumSingle"==e?(t=1,i=["album"]):"albumMultiple"==e?(t=9,i=["album"]):"video"==e&&alert(d),o.biz.util.chooseImage({count:t,secret:!1,sourceType:i,onSuccess:e=>{o.biz.util.compressImage({filePaths:e.filePaths,compressLevel:1,onSuccess:e=>{n(e)},onFail:e=>{}})},onFail:e=>{}})}))}};let S=!1,T=!1;const k="https://res.wx.qq.com/wwopen/js/jsapi/jweixin-1.0.0.js",L="微信微应用不支持此功能，请在iMobile中体验完整功能";function j(){alert(L)}function y(e,n=!0){const o=window.wx;if(o)T&&n?alert("配置失败请刷新页面"):!S&&n?R(e):e&&e(o);else{const n=document.createElement("script");n.src=k,document.querySelector("head")?.appendChild(n),n.readyState?n.onreadystatechange=()=>{R(e)}:n.onload=()=>{R(e)},window.supmobilejs||(window.supmobilejs={setupWebViewJavascriptBridge:y,scanQRCode:B,openVideo:j,downloadFile:j,pidTakePhoto:j,faceRecognition:j}),window.mobilejs||(window.mobilejs={setupWebViewJavascriptBridge:y,close:F,webGoBack:N,pushVC:A,scanQRCode:B})}}function R(n){!function(n){localStorage.getItem("ticket");const[o]=window.location.href.split("#");e({url:`/msService/public/base/jsapi/oAuth?oAuthType=wechat&openUrl=${o}`}).then((e=>{const o=e.data;n({corpid:o.corpid,agentid:o.agentid,timestamp:o.timestamp,nonceStr:o.nonceStr,signature:o.signature})})).catch((e=>{T=!0}))}((e=>{const o=window.wx;o.agentConfig({...e,jsApiList:["scanQRCode","getLocation","chooseImage"],success:function(e){S=!0,n&&n(o)},fail:function(e){T=!0}})}))}function F(){window.history.length<=1?y((e=>{e.closeWindow()}),!1):window.history.go(-(window.history.length-1))}function N(){window.history.back()}const A=e=>{window.open(window.location.origin+e,"_self")};function B(e){return new Promise((n=>{y((o=>{o.scanQRCode({desc:"scanQRCode desc",needResult:1,scanType:["qrCode","barCode"],success:function(o){var t=o.resultStr;n(t),e&&"function"==typeof e&&e(t)},error:function(e){alert("调用失败"+JSON.stringify(e))}})}))}))}const I=()=>{const e=n("suposTicket");return e||""};var W={initBridge:y,closeController:F,webGoBack:N,createNewWeb:A,getLocation:function(e){return new Promise((n=>{y((o=>{o.getLocation({type:"wgs84",success:function(o){const t={latitude:o.latitude,longitude:o.longitude};e&&e(t),n(t)}})}))}))},getTheme:()=>Promise.resolve("default"),getLanguage:function(e){var n=window.navigator.language;n.includes("zh-")?n="zh-cn":n.includes("en-")&&(n="en-us"),e(n)},getLanguageAtCookie:function(){const e=n("mobileLanguage");return e||""},isInMobileWebView:()=>"wechat",getTicketAtCookie:I,listRefresh:function(){const{ReactAPI:e}=window;e&&"function"==typeof e.refreshList&&e.refreshList()},openQRCode:B,clearLocalStoreage:()=>{},setNavigationTitle:j,loginAgain:()=>{},getUserMessage:()=>{},setTheme:j,setLanguage:j,getTicket:I,getTicketAtWebView:()=>"",setScreenOrientation:()=>{},downloadFile:j,openInfrared:j,openNFC:j,onShowFileChooser:function(e){y((e=>{e.chooseImage({count:1,sizeType:["original","compressed"],sourceType:["album","camera"],defaultCameraMode:"batch",isSaveToAlbum:1,success:function(e){var n=e.localIds;alert("img = "+n)}})}))}};return function(){let e=!1;switch(e=!0,function(){const e=window.navigator.userAgent;return e.includes("mesjg")&&e.includes("iPhone")?"iOS_iMobile":e.includes("mesjg")&&e.includes("Android")?"Android_iMobile":e.includes("DingTalk")?"DingTalk":e.includes("MicroMessenger")?"WeiXin":"Browser"}()){case"iOS_iMobile":case"Android_iMobile":return r.initBridge(),r;case"DingTalk":return C.initBridge(),C;case"WeiXin":return W.initBridge(),W;default:return r}}()}();
//# sourceMappingURL=iMobile.js.map
